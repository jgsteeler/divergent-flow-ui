[build]
  publish = "dist"
  command = "npm run build"

[build.environment]
  NODE_VERSION = "20"
  VITE_API_URL = "https://divergent-flow-gateway-staging.gscdev.workers.dev"
  VITE_OIDC_ISSUER = "https://divergent-flow-keycloak.fly.dev/realms/df-staging"
  VITE_OIDC_CLIENT_ID = "web-app"
  VITE_OIDC_REDIRECT_URI = "https://staging-ui.netlify.app/auth/callback"

[[redirects]]
  from = "/auth/callback"
  to = "/auth/callback"
  status = 200

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

[context.staging]
  [context.staging.environment]
    VITE_API_URL = "https://divergent-flow-gateway-staging.gscdev.workers.dev"
    VITE_OIDC_ISSUER = "https://divergent-flow-keycloak.fly.dev/realms/df-staging"
    VITE_OIDC_CLIENT_ID = "web-app"
    VITE_OIDC_REDIRECT_URI = "https://staging-ui.netlify.app/auth/callback"

[context.production]
  [context.production.environment]
    VITE_API_URL = "https://divergent-flow-gateway.gscdev.workers.dev"
    VITE_OIDC_ISSUER = "https://auth.divergentflow.com/realms/df-prod"
    VITE_OIDC_CLIENT_ID = "web-app"
    VITE_OIDC_REDIRECT_URI = "https://app.divergentflow.com/auth/callback"